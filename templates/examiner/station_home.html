{% extends 'examiner/base_examiner.html' %}
{% load static %}

{% block title %}My Stations - OSCE Examiner{% endblock %}

{% block body_class %}examiner-body home-page{% endblock %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/examiner-home.css' %}">
<link rel="stylesheet" href="{% static 'css/examiner-home-session-layout.css' %}">
{% endblock %}

{% block content %}
<!-- Unified Sticky Home Header -->
<header class="home-header">
    <div class="home-header-inner">

        <!-- Row 1: Brand | Page Title | Examiner + Actions -->
        <div class="home-row home-row-top">
            <div class="home-col-left">
                <div class="osce-brand">
                    <i class="bi bi-clipboard-check-fill"></i>
                    <span class="brand-text">OSCE Examiner</span>
                </div>
            </div>
            <div class="home-col-center">
                <div class="home-title-block">
                    <h1 class="home-page-title">
                        <i class="bi bi-calendar-check"></i>
                        My Exam Schedule
                    </h1>
                </div>
            </div>
            <div class="home-col-right">
                <span class="examiner-name-badge">
                    <i class="bi bi-person-fill"></i>
                    <span class="examiner-name-text">{{ request.user.display_name }}</span>
                </span>
                <a href="{% url 'profile' %}" class="home-action-btn" title="My Profile">
                    <i class="bi bi-person-circle"></i>
                    <span class="action-btn-text">Profile</span>
                </a>
                <a href="{% url 'examiner:logout' %}" class="home-action-btn">
                    <i class="bi bi-box-arrow-right"></i>
                    <span class="action-btn-text">Sign Out</span>
                </a>
            </div>
        </div>

        <!-- Row 2: Welcome text | (center empty) | Date -->
        <div class="home-row home-row-bottom">
            <div class="home-col-left">
                <p class="home-welcome-text">Welcome to your exam portal</p>
            </div>
            <div class="home-col-center"></div>
            <div class="home-col-right">
                <div class="home-date-badge">
                    <i class="bi bi-calendar3"></i>
                    <span>{{ today|date:"M d, Y" }}</span>
                </div>
            </div>
        </div>

    </div>
</header>

<div class="home-content">
    <div class="home-grid">
        <div class="home-main">
            <!-- Today's Stations -->
            <section class="section-card">
                <div class="section-header today">
                    <h2 class="section-title">
                        <i class="bi bi-calendar-day"></i>
                        <span>Today's Stations</span>
                    </h2>
                    <span class="section-count">{{ assignments|length }}</span>
                </div>

                {% if assignments %}
                    {% regroup assignments by session.name as sessions_list %}
                    
                    {% for session_group in sessions_list %}
                    <div class="session-group mb-4">
                        <div class="session-header">
                            <h4 class="session-name">
                                <i class="bi bi-layers me-2"></i>{{ session_group.grouper }}
                            </h4>
                        </div>
                        <div class="stations-row">
                            {% for item in session_group.list %}
                            <div class="station-card-compact">
                                <div class="station-card-small">
                                    <div class="path-badge-small">
                                        <i class="bi bi-signpost-split me-1"></i>Path {{ item.path_name }}
                                    </div>
                                    <h4 class="station-num">Station {{ item.station_number }}</h4>
                                    <p class="station-name-small">{{ item.station_name }}</p>
                                    
                                    <div class="station-info-small">
                                        <div class="info-item">
                                            <i class="bi bi-people"></i>
                                            <span><strong>{{ item.total_students }}</strong></span>
                                        </div>
                                        <div class="info-item">
                                            <i class="bi bi-clock"></i>
                                            <span>{% if item.session and item.session.start_time %}{{ item.session.start_time|time:"H:i" }}{% else %}TBD{% endif %}</span>
                                        </div>
                                    </div>
                                    
                                    <a href="{% url 'examiner:station_dashboard' item.assignment.id %}"
                                       class="btn-start-compact">
                                        <i class="bi bi-play-fill me-1"></i>Mark
                                    </a>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="empty-state-box">
                        <div class="empty-icon">
                            <i class="bi bi-calendar-x"></i>
                        </div>
                        <h3 class="empty-title">No Stations Assigned for Today</h3>
                        <p class="empty-text">Check your upcoming assignments below or contact the exam coordinator.</p>
                    </div>
                {% endif %}
            </section>
        </div>

        <div class="home-sidebar">
            <!-- Upcoming Assignments Side Card -->
            <section class="section-card">
                <div class="section-header upcoming">
                    <h2 class="section-title">
                        <i class="bi bi-calendar-week"></i>
                        <span>Upcoming</span>
                    </h2>
                    <span class="section-count">{{ upcoming_assignments|length }}</span>
                </div>

                {% if upcoming_assignments %}
                    {% for item in upcoming_assignments %}
                    <div class="upcoming-station-card">
                        <div class="upcoming-row">
                            <div class="date-box">
                                <div class="date-day">
                                    {% if item.session and item.session.session_date %}{{ item.session.session_date|date:"d" }}{% else %}?{% endif %}
                                </div>
                                <div class="date-month">
                                    {% if item.session and item.session.session_date %}{{ item.session.session_date|date:"M" }}{% endif %}
                                </div>
                            </div>

                            <div class="upcoming-details">
                                <div class="mb-1 text-success fw-bold small"><i class="bi bi-signpost-split me-1"></i>Path {{ item.path_name }}</div>
                                <h4 class="mb-0">St {{ item.station_number }} - {{ item.station_name }}</h4>
                                <p class="upcoming-info mt-1">
                                    {% if item.session and item.session.exam %}{{ item.session.exam.name }}{% else %}Exam{% endif %}
                                </p>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="p-4 text-center text-muted">
                        <p class="mb-0">No upcoming exams</p>
                    </div>
                {% endif %}
            </section>

        </div>
    </div>
</div>
{% endblock %}
