{% extends 'creator/base_creator.html' %}

{% block title %}{{ course.code }} - OSCE Creator{% endblock %}

{% block content %}
<div class="page-header d-flex flex-wrap justify-content-between align-items-start gap-2">
    <div>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'creator:dashboard' %}">Dashboard</a></li>
                <li class="breadcrumb-item"><a href="{% url 'creator:course_list' %}">Courses</a></li>
                <li class="breadcrumb-item active">{{ course.code }}</li>
            </ol>
        </nav>
        <h1>
            <span class="badge bg-secondary me-2">{{ course.code }}</span>
            {{ course.name }}
        </h1>
        <p class="text-muted mb-0">
            Year {{ course.year_level }} 
            <span class="mx-2">&bull;</span>
            {{ ilos|length }} ILOs
            {% if course.osce_mark %}
            <span class="mx-2">&bull;</span>
            <i class="bi bi-award me-1"></i>OSCE Mark: <strong>{{ course.osce_mark }} pts</strong>
            {% endif %}
        </p>
    </div>
    <div class="btn-group">
        <a href="{% url 'creator:course_edit' course.id %}" class="btn btn-outline-secondary">
            <i class="bi bi-pencil me-1"></i>Edit
        </a>
        <a href="{% url 'creator:ilo_create' course.id %}" class="btn btn-primary">
            <i class="bi bi-plus-lg me-1"></i>Add ILO
        </a>
    </div>
</div>

{% if course.description %}
<div class="alert alert-light">{{ course.description }}</div>
{% endif %}

<!-- ILOs Table -->
<div class="table-card">
    <div class="d-flex justify-content-between align-items-center p-3 border-bottom">
        <h5 class="mb-0"><i class="bi bi-bullseye me-2"></i>Intended Learning Outcomes (ILOs)</h5>
    </div>
    <div class="table-responsive">
    <table class="table table-hover mb-0">
        <thead>
            <tr>
                <th style="width: 60px;">#</th>
                <th>Description</th>
                <th style="width: 150px;">Theme</th>
                <th style="width: 100px;">OSCE Marks</th>
                <th style="width: 100px;">Library</th>
                <th style="width: 100px;">Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for ilo in ilos %}
            <tr>
                <td><span class="badge bg-secondary">{{ ilo.number }}</span></td>
                <td>{{ ilo.description }}</td>
                <td>
                    {% if ilo.theme_id and ilo.theme_id != 7 %}
                    <span class="badge theme-badge-{{ ilo.theme_id }}" style="color: white;">
                        {{ ilo.theme_name }}
                    </span>
                    {% else %}
                    <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    {% if ilo.osce_marks > 0 %}
                        <span class="badge bg-info">{{ ilo.osce_marks }}</span>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                </td>
                <td>
                    {% with lib_count=ilo.library_items.count %}
                    {% if lib_count > 0 %}
                        <span class="badge bg-secondary">{{ lib_count }} items</span>
                    {% else %}
                        <span class="text-muted">-</span>
                    {% endif %}
                    {% endwith %}
                </td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <a href="{% url 'creator:ilo_edit' ilo.id %}" class="btn btn-outline-secondary" title="Edit"><i class="bi bi-pencil"></i></a>
                        <a href="{% url 'creator:library_list' %}?ilo={{ ilo.id }}" class="btn btn-outline-primary" title="Library Items"><i class="bi bi-collection"></i></a>
                    </div>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="7" class="text-center text-muted py-5">
                    <i class="bi bi-bullseye fs-1 d-block mb-2"></i>
                    No ILOs defined for this course.<br>
                    <a href="{% url 'creator:ilo_create' course.id %}" class="btn btn-primary mt-3"><i class="bi bi-plus-lg me-1"></i>Add First ILO</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    </div>
</div>

<!-- ILO Theme Legend -->
<div class="stat-card mt-4">
    <h6 class="mb-3"><i class="bi bi-palette me-2"></i>Theme Legend</h6>
    <div class="row g-2">
        {% for tid, tdata in theme_map.items %}
        <div class="col-12 col-sm-6 col-lg-auto">
            <span class="badge theme-badge-{{ tid }} w-100 py-2" style="color: white; min-width: 130px; display: inline-block;">
                {{ tdata.name }}
            </span>
        </div>
        {% endfor %}
    </div>
</div>
{% endblock %}
